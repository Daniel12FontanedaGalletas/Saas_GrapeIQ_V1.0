<div class="space-y-8">
    <div id="margins-results-container" class="hidden">
        <h2 class="text-2xl font-bold text-stone-700 mb-4">Resultados de Rentabilidad</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-2xl shadow-lg text-center"><h3 class="font-semibold text-stone-500 mb-2">Margen Bruto</h3><p id="result-gross-margin" class="text-5xl font-bold text-green-700">-</p></div>
            <div class="bg-white p-6 rounded-2xl shadow-lg text-center"><h3 class="font-semibold text-stone-500 mb-2">Margen Neto Real</h3><p id="result-net-margin" class="text-5xl font-bold text-blue-700">-</p></div>
        </div>
    </div>

    <form id="financials-form" class="space-y-8">
        <div>
            <h2 class="text-2xl font-bold text-stone-700 mb-4">Calcular Márgenes de Rentabilidad</h2>
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <label for="total-revenue" class="block text-lg font-semibold mb-2">1. Ingresos Totales (Ventas) del Período (€)</label>
                <input type="number" step="0.01" id="total-revenue" placeholder="Ej: 50000.00" class="w-full max-w-sm bg-stone-50 p-3 rounded-lg border border-stone-300 text-lg">
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-2xl shadow-lg">
            <h3 class="text-xl font-bold text-stone-800 mb-4">2. Coste de los Bienes Vendidos (COGS)</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div><label for="cogs-raw-material" class="block mb-1 font-semibold">Materia Prima</label><input type="number" step="0.01" id="cogs-raw-material" placeholder="Coste de uva, levaduras..." class="w-full bg-stone-50 p-3 rounded-lg border border-stone-300"></div>
                <div><label for="cogs-packaging" class="block mb-1 font-semibold">Embotellado y Empaquetado</label><input type="number" step="0.01" id="cogs-packaging" placeholder="Botellas, corchos, cajas..." class="w-full bg-stone-50 p-3 rounded-lg border border-stone-300"></div>
                <div><label for="cogs-production" class="block mb-1 font-semibold">Elaboración y Crianza</label><input type="number" step="0.01" id="cogs-production" placeholder="Mano de obra, barricas..." class="w-full bg-stone-50 p-3 rounded-lg border border-stone-300"></div>
            </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-lg">
            <h3 class="text-xl font-bold text-stone-800 mb-4">3. Gastos Operativos del Período</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div><label for="op-sales-marketing" class="block mb-1 font-semibold">Venta y Marketing</label><input type="number" step="0.01" id="op-sales-marketing" placeholder="Salarios, publicidad, ferias..." class="w-full bg-stone-50 p-3 rounded-lg border border-stone-300"></div>
                <div><label for="op-admin" class="block mb-1 font-semibold">Administrativos</label><input type="number" step="0.01" id="op-admin" placeholder="Oficina, personal, software..." class="w-full bg-stone-50 p-3 rounded-lg border border-stone-300"></div>
                <div><label for="op-financial" class="block mb-1 font-semibold">Financieros e Impuestos</label><input type="number" step="0.01" id="op-financial" placeholder="Intereses, tasas, impuestos..." class="w-full bg-stone-50 p-3 rounded-lg border border-stone-300"></div>
            </div>
        </div>

        <div class="flex gap-4">
            <button type="submit" class="wine-grad text-white px-8 py-3 rounded-full font-bold text-lg hover:opacity-90">Calcular Márgenes</button>
            <button type="reset" id="reset-financials-btn" class="bg-stone-200 text-stone-700 px-6 py-3 rounded-full font-semibold hover:bg-stone-300">Limpiar Campos</button>
        </div>
    </form>
</div>

<script>
    (function() {
        const financialsForm = document.getElementById('financials-form');
        const resetFinancialsBtn = document.getElementById('reset-financials-btn');
        const resultsContainer = document.getElementById('margins-results-container');
        const resultGrossMargin = document.getElementById('result-gross-margin');
        const resultNetMargin = document.getElementById('result-net-margin');

        financialsForm.addEventListener('submit', function(event) {
            event.preventDefault();
            
            const totalRevenue = parseFloat(document.getElementById('total-revenue').value) || 0;
            if (totalRevenue === 0) {
                alert("Por favor, introduce los Ingresos Totales para poder calcular los márgenes.");
                return;
            }

            const totalCOGS = (parseFloat(document.getElementById('cogs-raw-material').value) || 0) +
                              (parseFloat(document.getElementById('cogs-packaging').value) || 0) +
                              (parseFloat(document.getElementById('cogs-production').value) || 0);

            const totalOpEx = (parseFloat(document.getElementById('op-sales-marketing').value) || 0) +
                            (parseFloat(document.getElementById('op-admin').value) || 0) +
                            (parseFloat(document.getElementById('op-financial').value) || 0);

            const grossMargin = totalRevenue > 0 ? ((totalRevenue - totalCOGS) / totalRevenue) * 100 : 0;
            const netMargin = totalRevenue > 0 ? ((totalRevenue - totalCOGS - totalOpEx) / totalRevenue) * 100 : 0;

            resultGrossMargin.textContent = `${grossMargin.toFixed(2)}%`;
            resultNetMargin.textContent = `${netMargin.toFixed(2)}%`;
            resultsContainer.style.display = 'block';
            window.scrollTo(0, 0);
        });

        resetFinancialsBtn.addEventListener('click', function() {
            resultsContainer.style.display = 'none';
            resultGrossMargin.textContent = '-';
            resultNetMargin.textContent = '-';
        });
    })();
</script>